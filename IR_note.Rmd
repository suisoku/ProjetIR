---
title: "Text Mining of Assemblé Generale Documents"
author: "ZIANI,MASSELIN,DIALLO,ANZID"
date: "March 29, 2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


```{r}
#Package
install.packages("syuzhet")
install.packages("tm")
```

```{r}
library(rvest)
library(xml2)
library(stringi)
# Extraction de la page html d'une séance unique (123eme) du 22/02/2017
textTreeBase <- read_html("http://www.assemblee-nationale.fr/14/cri/2016-2017/20170123.asp")

# Extraction 
textSeance20170123<- textTreeBase %>% html_nodes("body") %>% html_nodes("p") %>% html_text() #extraction dans le noeud <body> puis dnas le noeud <p>

```

```{r}
library(stringr)
library(dplyr)
# Création d'un object Data
text_seance20170123 <- tibble(line = 1:length(textSeance20170123), text = textSeance20170123)

# utilisation des regex pour désigner les hommes et les femmes
sexeM <- c("M\\. ")
sexeF <- c("Mme ")

president <- c("M\\. le président\\.")

#On ne garde que les discour des hommes et femmes dicriminer par leur sexe
text_seance20170123 <- text_seance20170123 %>%
  rowwise() %>% 
  mutate(sexe = if(str_detect(text, sexeM)) "Homme" else if(str_detect(text, sexeF)) "Femme" else "autre") %>% 
  filter(sexe != "autre")

text_seance20170123 <- text_seance20170123 %>%
  rowwise() %>% 
  mutate(rôle = if(str_detect(text,president)) "Président" else "Député")
```

Les mot les plus utiliser pendant le débat
```{r}
library(tidytext)
library(ggplot2)
t <- text_seance20170123 %>% 
  unnest_tokens(word, text) %>%
  filter(!str_detect(word, "[0-9]"))

t %>%
  count(word, sort = TRUE) %>%
  filter(n > 100) %>%
  mutate(word = reorder(word, n)) %>%
  ggplot(aes(word, n)) +
  geom_col() +
  xlab(NULL) +
  coord_flip()

#Filtre les nombres dans les mots et calcule le nombres de mots identique en fonction du sexe
t2 <- t %>%
  count(word,sexe, sort = TRUE) %>%
```


```{r}
#Les mots exclus
motstop <- read.delim("./stopword/stopwords-fr.txt")
motstop

t3 <-t2
t3 <- t3 %>%
  anti_join(motstop)
```
```{r}
#Les mots exclus
motstop2 <- read.delim("./stopword/stopword2-fr.txt")
motstop2

t4 <-t2
t4 <- t4 %>%
  anti_join(motstop2)
```




```{r}
t3 %>%
  group_by(sexe) %>%
  top_n(30) %>%
  ungroup() %>%
  mutate(word = reorder(word, n)) %>%
  ggplot(aes(word, n, fill = sexe)) +
  geom_col(show.legend = FALSE) +
  facet_wrap(~sexe, scales = "free_y") +
  labs(y = "Les Mots Favoris", x = NULL) +
  coord_flip()

t4 %>%
  group_by(sexe) %>%
  top_n(30) %>%
  ungroup() %>%
  mutate(word = reorder(word, n)) %>%
  ggplot(aes(word, n, fill = sexe)) +
  geom_col(show.legend = FALSE) +
  facet_wrap(~sexe, scales = "free_y") +
  labs(y = "Les Mots Favoris", x = NULL) +
  coord_flip()
```
On Observe que le premier filtre n'est pas adéquate car il retire bien trop de mot sigificatif comme "politiques"
```{r}

library(syuzhet)
library(tm)
library(ggplot2)
result <-get_nrc_sentiment(t[["word"]])
result1<-data.frame(t(result))
new_result <- data.frame(rowSums(result1))
names(new_result)[1] <- "count"
new_result <- cbind("sentiment" = rownames(new_result), new_result)
rownames(new_result) <- NULL
qplot(sentiment, data=new_result[1:8,], weight=count, geom="bar",fill=sentiment)+ggtitle("TedTalk Sentiments")
qplot(sentiment, data=new_result[9:10,], weight=count, geom="bar",fill=sentiment)+ggtitle("TedTalk Sentiments")

```

```{r}

t$word[t$sexe=="Femme"]->wordofWomen
t$word[t$sexe=="Homme"]->wordofMan

#partie Homme 
library(syuzhet)
library(tm)
library(ggplot2)
resultMan <-get_nrc_sentiment(wordofMan)
resultMan1<-data.frame(t(resultMan))
new_resultMan <- data.frame(rowSums(resultMan1))
names(new_resultMan)[1] <- "count"
new_resultMan <- cbind("sentiment" = rownames(new_resultMan), new_resultMan)
rownames(new_resultMan) <- NULL
qplot(sentiment, data=new_resultMan[1:8,], weight=count, geom="bar",fill=sentiment)+ggtitle("TedTalk Sentiments Homme ")
qplot(sentiment, data=new_resultMan[9:10,], weight=count, geom="bar",fill=sentiment)+ggtitle("TedTalk Sentiments Homme ")

#partie Femme 
library(syuzhet)
library(tm)
library(ggplot2)
resultWomen <-get_nrc_sentiment(wordofWomen)
resultWomen1<-data.frame(t(resultWomen))
new_resultWomen <- data.frame(rowSums(resultWomen1))
names(new_resultWomen)[1] <- "count"
new_resultWomen <- cbind("sentiment" = rownames(new_resultWomen), new_resultWomen)
rownames(new_resultMan) <- NULL
qplot(sentiment, data=new_resultWomen[1:8,], weight=count, geom="bar",fill=sentiment)+ggtitle("TedTalk Sentiments Femme")
qplot(sentiment, data=new_resultWomen[9:10,], weight=count, geom="bar",fill=sentiment)+ggtitle("TedTalk Sentiments Femme")


```


```{r}
# 
t  %>%   
  inner_join(get_sentiments("nrc")) %>%
  group_by(index = line %/% 25, sexe , sentiment) %>%
  summarize(n = n()) %>%
  ggplot(aes(x = index, y = n, fill = sexe )) + 
  geom_bar(stat = "identity", alpha = 0.8) + 
  facet_wrap(~ sentiment, ncol = 5) 

 

```

### Methodologie et Analyse
Il peut etre interessant de montrer les relatations ou des correleations entre les mots pour cela  nous prodedons au calculs bi-grams :
sequence continue de 2 mots

D'abord nous allons sectionner le tableau de mot duc corpus en tokens de 2 
Puis on genere un tableau avec 2 colonnes reprenants les token calcules
Puis on enleve les mots non pertinants
Finallement on trie les bigrams par fequence

```{r}
library(tidyr)
# 2-token unnnesting
textBigram <- t %>%  unnest_tokens(ngramData, word, token = "ngrams", n = 2)
#sort and count
textBigram %>% count(ngramData, sort = TRUE)

bigrams_separated <- textBigram %>%
  separate(ngramData, c("ngram1", "ngram2"), sep = " ")



bigrams_filtered <- bigrams_separated %>%
  filter(!ngram1 %in% motstop2$word) %>%
  filter(!ngram2 %in% motstop2$word)

# new bigram counts:
bigram_counts <- bigrams_filtered %>% 
  count(ngram1, ngram2, sort = TRUE)

bigram_counts

```

Resultat :
Les bigrams  comme secretaire d'etat et  groupe socialiste apparaissent le plus soucant dans ce corpus ce qui surligne leur importance dans le debat.
